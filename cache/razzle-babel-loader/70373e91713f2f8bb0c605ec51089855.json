{"ast":null,"code":"var _jsxFileName = \"/Users/t.cherednichenko/tatinacher/razzle-example/src/server.js\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { StaticRouter } from \"react-router-dom\";\nimport { Provider } from \"react-redux\";\nimport express from \"express\";\nimport { configureStore } from \"@reduxjs/toolkit\";\nimport { renderToString } from \"react-dom/server\";\nimport { ServerStyleSheet } from \"styled-components\";\nimport { cityReducer } from \"./features/city\";\nimport { App } from \"./App\";\nimport { url } from \"./lib/initial-data\";\n\nconst fetch = require(\"node-fetch\");\n\nrequire(\"dotenv\").config();\n\nconst assets = require(process.env.RAZZLE_ASSETS_MANIFEST);\n\nconst cssLinksFromAssets = (assets, entrypoint) => {\n  return assets[entrypoint] ? assets[entrypoint].css ? assets[entrypoint].css.map(asset => `<link rel=\"stylesheet\" href=\"${asset}\">`).join(\"\") : \"\" : \"\";\n};\n\nconst jsScriptTagsFromAssets = (assets, entrypoint, extra = \"\") => {\n  return assets[entrypoint] ? assets[entrypoint].js ? assets[entrypoint].js.map(asset => `<script src=\"${asset}\"${extra}></script>`).join(\"\") : \"\" : \"\";\n};\n\nconst createStore = result => configureStore({\n  reducer: {\n    city: cityReducer\n  },\n  preloadedState: {\n    city: result\n  }\n});\n\nconst server = express();\nserver.disable(\"x-powered-by\").use(express.static(process.env.RAZZLE_PUBLIC_DIR)).get(\"/*\", (req, res) => mainPage(req, res)).get(\"/city/weather/:id\", (req, res) => cityPage(req, res));\nexport const cityPage = (req, res) => fetch(url(req.params.id)).then(res => res.json()).then(result => createStore(result)).then(store => createPage(req, store)).then(render => res.send(render));\nexport const mainPage = (req, res) => {\n  const store = createStore();\n  const render = createPage(req, store);\n  res.send(render);\n};\n\nconst createPage = (req, store) => {\n  const sheet = new ServerStyleSheet();\n  const markup = sheet.collectStyles(renderToString(__jsx(Provider, {\n    store: store,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }\n  }, __jsx(StaticRouter, {\n    location: req.path,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  }, __jsx(App, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 11\n    }\n  })))));\n  const styleTags = sheet.getStyleTags();\n  const preloadedState = store.getState();\n  return `<!doctype html>\n    <html lang=\"\">\n    <head>\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n        <meta charset=\"utf-8\" />\n        <title>Welcome to Razzle</title>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        ${styleTags}\n    </head>\n    <body>\n        <div id=\"root\">${markup}</div>\n        ${jsScriptTagsFromAssets(assets, \"client\", \" defer crossorigin\")}\n        <script> window.__PRELOADED_STATE__ = ${JSON.stringify(preloadedState).replace(/</g, \"\\\\u003c\")}</script>\n    </body>\n</html>`;\n};\n\nexport default server;","map":{"version":3,"sources":["/Users/t.cherednichenko/tatinacher/razzle-example/src/server.js"],"names":["React","StaticRouter","Provider","express","configureStore","renderToString","ServerStyleSheet","cityReducer","App","url","fetch","require","config","assets","process","env","RAZZLE_ASSETS_MANIFEST","cssLinksFromAssets","entrypoint","css","map","asset","join","jsScriptTagsFromAssets","extra","js","createStore","result","reducer","city","preloadedState","server","disable","use","static","RAZZLE_PUBLIC_DIR","get","req","res","mainPage","cityPage","params","id","then","json","store","createPage","render","send","sheet","markup","collectStyles","path","styleTags","getStyleTags","getState","JSON","stringify","replace"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { StaticRouter } from \"react-router-dom\";\nimport { Provider } from \"react-redux\";\nimport express from \"express\";\nimport { configureStore } from \"@reduxjs/toolkit\";\nimport { renderToString } from \"react-dom/server\";\nimport { ServerStyleSheet } from \"styled-components\";\n\nimport { cityReducer } from \"./features/city\";\nimport { App } from \"./App\";\nimport { url } from \"./lib/initial-data\";\n\nconst fetch = require(\"node-fetch\");\n\nrequire(\"dotenv\").config();\n\nconst assets = require(process.env.RAZZLE_ASSETS_MANIFEST);\n\nconst cssLinksFromAssets = (assets, entrypoint) => {\n  return assets[entrypoint]\n    ? assets[entrypoint].css\n      ? assets[entrypoint].css\n          .map((asset) => `<link rel=\"stylesheet\" href=\"${asset}\">`)\n          .join(\"\")\n      : \"\"\n    : \"\";\n};\n\nconst jsScriptTagsFromAssets = (assets, entrypoint, extra = \"\") => {\n  return assets[entrypoint]\n    ? assets[entrypoint].js\n      ? assets[entrypoint].js\n          .map((asset) => `<script src=\"${asset}\"${extra}></script>`)\n          .join(\"\")\n      : \"\"\n    : \"\";\n};\n\nconst createStore = (result) =>\n  configureStore({\n    reducer: {\n      city: cityReducer,\n    },\n    preloadedState: {\n      city: result,\n    },\n  });\n\nconst server = express();\nserver\n  .disable(\"x-powered-by\")\n  .use(express.static(process.env.RAZZLE_PUBLIC_DIR))\n  .get(\"/*\", (req, res) => mainPage(req, res))\n  .get(\"/city/weather/:id\", (req, res) => cityPage(req, res));\n\nexport const cityPage = (req, res) =>\n  fetch(url(req.params.id))\n    .then((res) => res.json())\n    .then((result) => createStore(result))\n    .then((store) => createPage(req, store))\n    .then((render) => res.send(render));\n\nexport const mainPage = (req, res) => {\n  const store = createStore();\n  const render = createPage(req, store);\n  res.send(render);\n};\n\nconst createPage = (req, store) => {\n  const sheet = new ServerStyleSheet();\n\n  const markup = sheet.collectStyles(\n    renderToString(\n      <Provider store={store}>\n        <StaticRouter location={req.path}>\n          <App />\n        </StaticRouter>\n      </Provider>\n    )\n  );\n\n  const styleTags = sheet.getStyleTags();\n  const preloadedState = store.getState();\n\n  return `<!doctype html>\n    <html lang=\"\">\n    <head>\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n        <meta charset=\"utf-8\" />\n        <title>Welcome to Razzle</title>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        ${styleTags}\n    </head>\n    <body>\n        <div id=\"root\">${markup}</div>\n        ${jsScriptTagsFromAssets(assets, \"client\", \" defer crossorigin\")}\n        <script> window.__PRELOADED_STATE__ = ${JSON.stringify(\n          preloadedState\n        ).replace(/</g, \"\\\\u003c\")}</script>\n    </body>\n</html>`;\n};\n\nexport default server;\n"]},"metadata":{},"sourceType":"module"}